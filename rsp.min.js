function Resp(e){var t=(e=e||{}).apiKey;if(!(t&&t.length>0))throw new Error("expecting apiKey to have been set");if(this.searchElement=document.getElementById(e.itemId),!this.searchElement)throw new Error("expected itemId to have been set");if(this.uid=e.uid||"",this.services=e.services||{},timeoutWaitMillis=e.timeoutWaitMillis||3e3,this.maxTypingPeriodMs=90,this.onMessage=e.onMessage,"function"!=typeof this.onMessage)throw new Error("expecting onMessage to have been set");this.onError=e.onError,this.onConnected=e.onConnected,this.onDisconnected=e.onDisconnected,this.onStoppedTyping=e.onStoppedTyping,this.onTyping=e.onTyping,this.onAcknowledgement=e.onAcknowledgement,this.EventTyping="typing",this.EventInitialized="initialized",this.EventNewData="newData",this.EventNewSearch="newSearch",this.EventStoppedTyping="stoppedTyping",this.EventAcknowledgement="acknowledgement";var n=new XMLHttpRequest;this.connected=!1;var i=this;n.onreadystatechange=function(){var t=this;if(4===t.readyState){if(!(t.status>=200&&t.status<=299))throw new Error(t.responseText);var n=JSON.parse(t.responseText);setWSAddr(n.WSURL),i.persistenceKey=n.key,i.initSocket(e.initialSearch)}},n.open("POST","https://rsp.orijtech.com/auth",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({api_key:t})),i.searchElement.addEventListener("input",function(){i.handleTypingEvents()})}function invokeIfDefined(e,t){"function"==typeof e&&e(t)}function setWSAddr(e){wsAddr=e}Resp.prototype.handleErr=function(e){"function"==typeof this.onError?this.onError(e):console.log("handled exception %s",e)};var wsAddr="",timeoutWaitMillis=0;Resp.prototype.initSocket=function(e){try{this.socket=new WebSocket(wsAddr)}catch(e){console.log("failed to connect here! ",e)}finally{this.socket||console.log("failed to connect :(")}this.connected=!1,this.uid="";var t=this;t.socket.addEventListener("message",function(e){var n=e.data||"{}";try{n=JSON.parse(n)}catch(e){return void t.handleErr(e)}t.muxOnResponseData(n)}),t.socket.addEventListener("open",function(){"function"==typeof t.onConnected&&t.onConnected(),t.connected=!0,e&&e.length>0&&t.search(e)});var n=function(){t.initSocket(t.lastInput)};t.socket.addEventListener("close",function(){t.connected=!1,"function"==typeof t.onDisconnected&&t.onDisconnected(),setTimeout(n,timeoutWaitMillis)}),t.socket.addEventListener("error",function(e){console.log("onerr ",e)})},Resp.prototype.handleTypingEvents=function(){if(this.connected){this.typing||(this.typing=!0);var e=this;e.getCurrTimeEpochSeconds()-e.lastTypingTime>=e.maxTypingPeriodMs&&e.typing&&(e._emit({event:e.EventStoppedTyping,uid:e.uid}),e.typing=!1),e.typing||e._doSearch(),this.lastTypingTime=this.getCurrTimeEpochSeconds()}},Resp.prototype.search=function(e){this.lastInput=e,this._emit({value:e,event:this.EventNewSearch,services:this.services,uid:this.uid})},Resp.prototype._doSearch=function(e){var t=this.searchElement.value,n=t&&t.length>0,i=e&&e.length>0;if(!n){if(!i)return;t=e}t!==this.lastInput&&this.search(t)},Resp.prototype._emit=function(e){if(this.connected)try{this.socket.send(JSON.stringify(e))}catch(e){console.log("_emit exception ",e)}},Resp.prototype.handleNewData=function(e){"function"==typeof this.onMessage&&this.onMessage(e)},Resp.prototype.muxOnResponseData=function(e){switch(e.event){case this.EventNewData:this.handleNewData(e);break;case this.EventTyping:invokeIfDefined(this.onTyping,e);break;case this.EventInitialized:invokeIfDefined(this.onInitialized,e);break;case this.EventStoppedTyping:invokeIfDefined(this.onStoppedTyping,e);break;case this.EventAcknowledgement:invokeIfDefined(this.onAcknowledgement,e)}},Resp.prototype.getCurrTimeEpochSeconds=function(){return(new Date).getTime()};